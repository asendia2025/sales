<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Team 1 - SaaS</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://github.com/asendia2025/sales/blob/main/img/logo_company_transparency.png?raw=true">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js & Datalabels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', '"Noto Sans KR"', 'sans-serif'],
                        montserrat: ['Montserrat', 'sans-serif']
                    },
                    colors: {
                        brand: {
                            50: '#fbf7ff', 
                            100: '#f5f0ff', 
                            500: '#a78bfa', 
                            600: '#9333ea', 
                            700: '#7e22ce', 
                            900: '#581c87',
                        },
                        zinc: {
                            50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8', 400: '#a1a1aa',
                            500: '#71717a', 600: '#52525b', 700: '#3f3f46', 800: '#27272a', 900: '#18181b'
                        }
                    },
                    animation: {
                        'pulse-green': 'pulse-green 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'pulse-orange': 'pulse-orange 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'pulse-green': {
                            '0%, 100%': { borderColor: '#10b981', boxShadow: '0 0 0 0 rgba(16, 185, 129, 0.7)' },
                            '50%': { borderColor: '#34d399', boxShadow: '0 0 0 10px rgba(16, 185, 129, 0)' },
                        },
                        'pulse-orange': {
                            '0%, 100%': { borderColor: '#f97316', boxShadow: '0 0 0 0 rgba(249, 115, 22, 0.7)' },
                            '50%': { borderColor: '#fb923c', boxShadow: '0 0 0 10px rgba(249, 115, 22, 0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; color: #1e293b; overflow: hidden; }
        .white-card { background: #ffffff; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .sidebar { transition: width 0.3s ease; border-right: 1px solid #e2e8f0; background: #ffffff; }
        
        .nav-item { transition: all 0.2s; cursor: pointer; color: #64748b; border-radius: 0.75rem; margin-bottom: 0.25rem; }
        .nav-item:hover { background-color: #f3e8ff; color: #7e22ce; }
        
        .nav-item.active { 
            background-color: #a855f7; 
            color: #ffffff; 
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        select, input { background-color: #ffffff !important; border: 1px solid #e2e8f0 !important; color: #0f172a !important; }
        select:focus, input:focus { border-color: #a855f7 !important; outline: none; box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.1); }
        
        .stat-card-hover:hover { border-color: #a855f7; transform: translateY(-2px); box-shadow: 0 10px 30px -10px rgba(168, 85, 247, 0.15); }
        .progress-badge { font-size: 10px; font-weight: 800; padding: 2px 8px; border-radius: 9999px; text-transform: uppercase; }
        .status-open { background-color: #f3e8ff; color: #7e22ce; border: 1px solid #e9d5ff; }
        .status-finished { background-color: #f0fdf4; color: #16a34a; border: 1px solid #dcfce7; }
        .status-close { background-color: #f8fafc; color: #64748b; border: 1px solid #e2e8f0; }
        
        .border-fast { border: 2px solid #22c55e !important; }
        .border-slow { border: 2px solid #f97316 !important; }
        .light-green { background-color: #22c55e; box-shadow: 0 0 8px rgba(34, 197, 94, 0.4); }
        .light-red { background-color: #ef4444; box-shadow: 0 0 8px rgba(239, 68, 68, 0.4); }
        .light-gray { background-color: #cbd5e1; }
        .prog-green { background-color: #22c55e; }
        .prog-orange { background-color: #f97316; }
        .prog-gray { background-color: #e2e8f0; }
        .bg-ontrack { background-color: #ecfdf5; color: #047857; }
        .bg-delayed { background-color: #fef2f2; color: #b91c1c; }
        .bg-critical { background-color: #fffbeb; color: #b45309; }
        .bg-completed { background-color: #eff6ff; color: #1d4ed8; }

        .card-pulse-green { border: 2px solid #10b981; animation: pulse-green 2s infinite; }
        .card-pulse-orange { border: 2px solid #f97316; animation: pulse-orange 2s infinite; }
        
        .project-stat-card {
            border-radius: 1rem;
            background: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .project-stat-card:hover { transform: translateY(-2px); }
        
        .project-card-blue { border-color: #3b82f6; }   
        .project-card-amber { border-color: #f59e0b; }  
        .project-card-emerald { border-color: #10b981; } 

        /* Spinner for Button */
        .spinner {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 2px solid white;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Login Overlay -->
    <div id="login-overlay" class="fixed inset-0 z-[9999] flex items-center justify-center bg-slate-900">
        <div class="bg-white p-10 rounded-2xl shadow-2xl w-full max-w-md text-center border border-slate-200">
            <div class="mb-6 flex justify-center">
                 <div class="w-16 h-16 flex items-center justify-center bg-slate-50 rounded-2xl shadow-sm border border-slate-100 overflow-hidden p-2">
                    <img src="https://github.com/asendia2025/sales/blob/main/img/logo_company_transparency.png?raw=true" alt="Company Logo" class="w-full h-full object-contain">
                </div>
            </div>
            <h1 class="text-2xl font-bold text-slate-800 font-montserrat mb-2">Sales System</h1>
            <p class="text-slate-500 text-sm mb-8">Sales Index & Project Dashboard Login</p>

            <form id="login-form" class="space-y-4 text-left">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Email</label>
                    <input type="email" id="email" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none transition-all" placeholder="name@company.com" required>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 outline-none transition-all" placeholder="••••••••" required>
                </div>
                <button type="submit" id="login-btn" class="w-full py-3.5 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2">
                    <span class="btn-text">Sign In</span>
                </button>
            </form>

            <div class="mt-4">
                <a href="#" id="forgot-pw-btn" class="text-sm text-slate-400 hover:text-brand-600 transition-colors font-medium">Forgot Password?</a>
            </div>

            <div id="error-message" class="mt-4 text-rose-500 text-sm font-medium hidden"></div>
        </div>
    </div>

    <!-- App Container (Hidden by default) -->
    <div id="app-container" class="flex h-screen bg-slate-50 text-slate-900 hidden">

        <!-- Sidebar -->
        <aside class="sidebar w-64 flex flex-col z-20 px-4">
            <div class="py-6 flex items-center gap-3 border-b border-slate-100 mb-4">
                <div class="w-10 h-10 flex items-center justify-center bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                    <img src="https://github.com/asendia2025/sales/blob/main/img/logo_company_transparency.png?raw=true" alt="Company Logo" class="w-full h-full object-contain p-1">
                </div>
                <div>
                    <h1 class="font-montserrat font-bold text-lg text-slate-900 leading-tight tracking-tight">ASENDIA</h1>
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">Sales Team 1</p>
                </div>
            </div>

            <nav class="flex-1 space-y-1 overflow-y-auto custom-scrollbar">
                <p class="px-2 py-3 text-[11px] font-bold text-slate-400 uppercase tracking-widest">Main Modules</p>
                <a onclick="switchModule('sales')" id="nav-sales" class="nav-item active flex items-center gap-3 px-4 py-3 text-sm font-medium">
                    <i data-lucide="trending-up" class="w-5 h-5"></i>
                    <span>Sales Performance</span>
                </a>
                <a onclick="switchModule('project')" id="nav-project" class="nav-item flex items-center gap-3 px-4 py-3 text-sm font-medium">
                    <i data-lucide="box" class="w-5 h-5"></i>
                    <span>ASM Project Mgmt</span>
                </a>
                <a onclick="switchModule('core')" id="nav-core" class="nav-item flex items-center gap-3 px-4 py-3 text-sm font-medium">
                    <i data-lucide="star" class="w-5 h-5"></i>
                    <span>ASM Core Project</span>
                </a>
                <a class="nav-item flex items-center gap-3 px-4 py-3 text-sm font-medium opacity-50 cursor-not-allowed">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span>ASM Customer Mgmt</span>
                    <span class="ml-auto text-[10px] bg-slate-100 border border-slate-200 px-1.5 py-0.5 rounded text-slate-400">Soon</span>
                </a>
                <p class="px-2 py-3 text-[11px] font-bold text-slate-400 uppercase tracking-widest mt-4">Settings</p>
                <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 text-sm font-medium">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    <span>System Settings</span>
                </a>
                <!-- Sign Out / Change PW Added -->
                <a href="#" id="change-pw-btn" class="nav-item flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-500">
                    <i data-lucide="lock" class="w-5 h-5"></i>
                    <span>Change Password</span>
                </a>
                <a href="#" id="logout-btn" class="nav-item flex items-center gap-3 px-4 py-3 text-sm font-medium text-rose-500 hover:bg-rose-50 hover:text-rose-600">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                    <span>Sign Out</span>
                </a>

                <a href="biz_data_processor.html" target="_blank" class="nav-item flex items-center gap-3 px-4 py-3 text-sm font-medium mt-4 border-t border-slate-100 pt-4">
                    <i data-lucide="database" class="w-5 h-5"></i>
                    <span>Business Data Processor</span>
                </a>
            </nav>

            <div class="py-4 mt-auto border-t border-slate-100">
                <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-slate-50 transition-colors cursor-pointer">
                    <div class="w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center text-brand-700 font-bold text-xs">
                        ST
                    </div>
                    <div class="overflow-hidden">
                        <p class="text-xs font-bold text-slate-700 truncate" id="user-email-display">Sales Team 1</p>
                        <p class="text-[10px] text-slate-500">Administrator</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden relative">
            <!-- Header -->
            <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 shrink-0 z-10">
                <h2 id="header-title" class="font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="pie-chart" class="w-5 h-5 text-brand-700"></i>
                    Integrated Sales Dashboard
                </h2>
                <div id="header-actions" class="flex items-center gap-2">
                    <div class="bg-slate-100 rounded-lg p-1 flex border border-slate-200">
                        <button id="mode-all" onclick="switchSalesMode('ALL')" class="px-4 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700 border border-slate-100 transition-all">ASENDIA</button>
                        <button id="mode-sales1" onclick="switchSalesMode('SALES1')" class="px-4 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 transition-all">Sales 1</button>
                        <button id="mode-sales2" onclick="switchSalesMode('SALES2')" class="px-4 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 transition-all">Sales 2</button>
                        <button id="mode-service" onclick="switchSalesMode('SERVICE')" class="px-4 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 transition-all">Service</button>
                    </div>
                </div>
            </header>

            <!-- Module: Sales Dashboard -->
            <div id="module-sales" class="flex-1 overflow-y-auto custom-scrollbar p-8 block relative z-0">
                <div class="max-w-7xl mx-auto space-y-8">
                    
                    <!-- Filters Section -->
                    <div class="white-card p-4 rounded-2xl flex gap-6 items-center flex-wrap" id="sales-filters-container">
                        <div class="flex items-center gap-2" id="customer-filter-group">
                             <span class="text-sm font-bold text-slate-500 flex items-center gap-2">
                                <i data-lucide="filter" class="w-4 h-4"></i> Customer:
                            </span>
                            <select id="filter-customer" class="text-sm border rounded-lg px-3 py-2 cursor-pointer hover:bg-slate-50 min-w-[200px]">
                                <option value="ALL">All Customers</option>
                            </select>
                        </div>

                        <!-- Category Buttons -->
                        <div class="flex items-center gap-2" id="category-filter-group">
                            <span class="text-sm font-bold text-slate-500 flex items-center gap-2 mr-1">
                                <i data-lucide="layers" class="w-4 h-4"></i> Category:
                            </span>
                            <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                                <button onclick="setSalesCategoryFilter('ALL')" id="btn-cat-all" class="px-3 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700">All</button>
                                <button onclick="setSalesCategoryFilter('Sales')" id="btn-cat-sales" class="px-3 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 flex items-center gap-1"><i data-lucide="dollar-sign" class="w-3 h-3"></i>Sales</button>
                                <button onclick="setSalesCategoryFilter('Repair')" id="btn-cat-repair" class="px-3 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 flex items-center gap-1"><i data-lucide="wrench" class="w-3 h-3"></i>Repair</button>
                            </div>
                        </div>

                        <!-- Automotive Filter Button -->
                        <div class="flex items-center gap-2 ml-auto hidden" id="auto-filter-wrapper">
                            <button onclick="toggleAutomotiveFilter()" id="btn-auto-filter" class="px-3 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700 border border-slate-200 transition-all flex items-center gap-2">
                                <i data-lucide="cpu" class="w-4 h-4"></i>
                                <span id="txt-auto-filter">전장사업부 포함</span>
                            </button>
                        </div>

                        <!-- Exclude ASM_CM Button (Service Mode Only) -->
                        <div class="flex items-center gap-2 ml-auto hidden" id="exclude-asmcm-wrapper">
                            <button onclick="toggleAsmCmExclusion()" id="btn-exclude-asmcm" class="px-3 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700 border border-slate-200 transition-all flex items-center gap-2">
                                <i data-lucide="minus-circle" class="w-4 h-4 text-brand-700"></i>
                            </button>
                        </div>
                    </div>

                    <!-- KPI Cards -->
                    <div id="sales-kpi-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Cards will be injected dynamically -->
                    </div>

                    <!-- Sales Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Chart Area -->
                        <div class="lg:col-span-2 white-card rounded-2xl p-8 h-[450px] relative flex flex-col">
                            <div class="flex justify-between items-center mb-4 shrink-0">
                                <h3 id="chart-main-title" class="font-bold text-slate-800">Sales Trend</h3>
                                
                                <!-- Chart Type Toggle (Updated) -->
                                <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                                    <button onclick="setChartType('normal')" id="btn-chart-normal" class="px-3 py-1 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700">Monthly</button>
                                    <button onclick="setChartType('cumulative')" id="btn-chart-cumulative" class="px-3 py-1 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800">Cumulative</button>
                                    <button onclick="setChartType('yearly')" id="btn-chart-yearly" class="px-3 py-1 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800">Yearly</button>
                                </div>
                            </div>
                            <div class="flex-1 relative w-full h-full">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>

                        <!-- Secondary Chart or Table Area -->
                        <div id="sales-secondary-container" class="lg:col-span-2 white-card rounded-2xl p-8 overflow-hidden flex flex-col min-h-[400px]">
                            <!-- Dynamic Content (Table or Chart) -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module: ASM Project Management -->
            <div id="module-project" class="flex-1 overflow-y-auto custom-scrollbar p-8 hidden relative z-0">
                <div class="max-w-7xl mx-auto space-y-6">
                    <!-- Project Stats (Updated Design: Colored Borders) -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="project-stat-card project-card-blue p-5 flex justify-between items-start">
                            <div>
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Total Projects</p>
                                <h3 id="pstat-total" class="text-2xl font-bold text-slate-900 tracking-tight">0</h3>
                            </div>
                            <div class="p-2.5 bg-blue-50 text-blue-500 rounded-xl">
                                <i data-lucide="layers" class="w-5 h-5"></i>
                            </div>
                        </div>
                        <div class="project-stat-card project-card-amber p-5 flex justify-between items-start">
                            <div>
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Open Projects</p>
                                <h3 id="pstat-open" class="text-2xl font-bold text-slate-900 tracking-tight">0</h3>
                            </div>
                            <div class="p-2.5 bg-amber-50 text-amber-500 rounded-xl">
                                <i data-lucide="clock" class="w-5 h-5"></i>
                            </div>
                        </div>
                        <div class="project-stat-card project-card-emerald p-5 flex justify-between items-start">
                            <div>
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Done/Closed</p>
                                <h3 id="pstat-done" class="text-2xl font-bold text-slate-900 tracking-tight">0</h3>
                            </div>
                            <div class="p-2.5 bg-emerald-50 text-emerald-500 rounded-xl">
                                <i data-lucide="check-check" class="w-5 h-5"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 white-card p-4 rounded-2xl shadow-sm">
                        <div class="space-y-1.5">
                            <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Department</label>
                            <select id="filterDept" class="w-full rounded-xl px-4 py-3 text-sm font-semibold cursor-pointer">
                                <option value="ALL">All Departments</option>
                                <option value="R&D">R&D</option>
                                <option value="MFG">MFG</option>
                            </select>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Category</label>
                            <select id="filterCategory" class="w-full rounded-xl px-4 py-3 text-sm font-semibold cursor-pointer">
                                <option value="ALL">All Categories</option>
                                <option value="RFG">RFG</option>
                                <option value="RFM">RFM</option>
                                <option value="CONTROLLER">Controller</option>
                                <option value="Etc">Etc</option>
                            </select>
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Status</label>
                            <div class="flex bg-slate-100 p-1 rounded-xl h-[46px] border border-slate-200" id="status-btn-container">
                                <button onclick="setStatusFilter('OPEN')" id="btn-status-OPEN" class="flex-1 rounded-lg text-xs font-bold transition-all text-slate-400 hover:text-slate-800 hover:bg-white">OPEN</button>
                                <button onclick="setStatusFilter('FINISHED')" id="btn-status-FINISHED" class="flex-1 rounded-lg text-xs font-bold transition-all text-slate-400 hover:text-slate-800 hover:bg-white">FINISHED</button>
                                <button onclick="setStatusFilter('CLOSE')" id="btn-status-CLOSE" class="flex-1 rounded-lg text-xs font-bold transition-all text-slate-400 hover:text-slate-800 hover:bg-white">CLOSE</button>
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="white-card rounded-2xl overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-xs">
                                <thead class="bg-slate-50 text-slate-500 font-bold uppercase tracking-widest border-b border-slate-200">
                                    <tr>
                                        <th class="px-6 py-4">Pri.</th>
                                        <th class="px-6 py-4">Customer/Requestor</th>
                                        <th class="px-6 py-4">Category</th>
                                        <th class="px-6 py-4">Model / PN</th>
                                        <th class="px-6 py-4">Qty</th>
                                        <th class="px-6 py-4">Spec / App</th>
                                        <th class="px-6 py-4">Dept / NBD</th>
                                        <th class="px-6 py-4">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="project-table-body" class="divide-y divide-slate-100 text-slate-600"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module: ASM Core Project -->
            <div id="module-core" class="flex-1 overflow-y-auto custom-scrollbar p-8 hidden relative z-0">
                <div class="max-w-7xl mx-auto space-y-8">
                    <!-- Header Info & Filter -->
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">Core Projects</h2>
                            <p class="text-slate-500 text-sm mt-1">High-priority strategic projects for ASM</p>
                        </div>
                        
                        <!-- Core Filter -->
                        <div class="flex bg-slate-100 p-1 rounded-xl border border-slate-200" id="core-filter-container">
                            <button onclick="setCoreFilter('Active')" id="btn-core-active" class="px-4 py-2 rounded-lg text-xs font-bold transition-all bg-white shadow-sm text-brand-700 border border-slate-200">Active (On Track & Delayed)</button>
                            <button onclick="setCoreFilter('Completed')" id="btn-core-completed" class="px-4 py-2 rounded-lg text-xs font-bold transition-all text-slate-500 hover:text-slate-800 hover:bg-white/50">Completed</button>
                            <button onclick="setCoreFilter('All')" id="btn-core-all" class="px-4 py-2 rounded-lg text-xs font-bold transition-all text-slate-500 hover:text-slate-800 hover:bg-white/50">All</button>
                        </div>
                    </div>

                    <!-- Core Project Cards Grid -->
                    <div id="core-project-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Cards will be injected via JS -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-brand-600 text-white px-8 py-4 rounded-2xl shadow-2xl shadow-brand-200 transform translate-y-32 opacity-0 transition-all duration-300 flex items-center gap-3 z-50">
        <i data-lucide="check-circle" class="text-white w-5 h-5"></i>
        <span id="toast-message" class="font-bold text-sm">Successfully processed.</span>
    </div>

    <!-- Data Imports -->
    <script src="./sales_data_2023.js"></script>
    <script src="./sales_data_2024.js"></script>
    <script src="./sales_data_2025.js"></script>
    <script src="./sales_data_2026.js"></script>
    <script src="./sales_target_data_2026.js"></script>
    <script src="./project_asm.js"></script>
    <script src="./core_project_data.js"></script>

    <!-- Firebase Auth Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Provided Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCwNHcdB0yFHm3fqJAbqMtD4Kx7LBsNpnM",
            authDomain: "sales-costing.firebaseapp.com",
            projectId: "sales-costing",
            storageBucket: "sales-costing.firebasestorage.app",
            messagingSenderId: "160253556783",
            appId: "1:160253556783:web:54b6daf3a1157864cceeda",
            measurementId: "G-E5KL85FC3X"
        };

        // Initialize Firebase
        let app, auth;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            console.log("Firebase initialized");
        } catch (e) {
            console.error("Firebase init error:", e);
        }

        // Elements
        const loginOverlay = document.getElementById("login-overlay");
        const appContainer = document.getElementById("app-container");
        const loginForm = document.getElementById("login-form");
        const errorMsg = document.getElementById("error-message");
        const loginBtn = document.getElementById("login-btn");
        const btnText = loginBtn.querySelector(".btn-text");
        const userEmailDisplay = document.getElementById("user-email-display");
        const logoutBtn = document.getElementById("logout-btn");
        const forgotPwBtn = document.getElementById("forgot-pw-btn");
        const changePwBtn = document.getElementById("change-pw-btn");

        // Auth State Listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User logged in:", user.email);
                userEmailDisplay.textContent = user.email;
                loginOverlay.classList.add('hidden');
                appContainer.classList.remove('hidden');
                // Ensure chart renders if loaded while hidden
                if(window.renderSalesDashboard) window.renderSalesDashboard();
            } else {
                console.log("No user");
                loginOverlay.classList.remove('hidden');
                appContainer.classList.add('hidden');
            }
        });

        // Login
        loginForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            errorMsg.classList.add('hidden');
            loginBtn.disabled = true;
            btnText.textContent = "Signing in...";
            
            // Add spinner
            const spinner = document.createElement("div");
            spinner.className = "spinner";
            loginBtn.insertBefore(spinner, btnText);

            signInWithEmailAndPassword(auth, email, password)
                .catch((error) => {
                    errorMsg.classList.remove('hidden');
                    switch (error.code) {
                        case 'auth/invalid-email': errorMsg.textContent = "Invalid email format."; break;
                        case 'auth/user-not-found':
                        case 'auth/wrong-password':
                        case 'auth/invalid-credential': errorMsg.textContent = "Incorrect email or password."; break;
                        case 'auth/too-many-requests': errorMsg.textContent = "Too many attempts. Try again later."; break;
                        default: errorMsg.textContent = "Login failed: " + error.message;
                    }
                    loginBtn.disabled = false;
                    btnText.textContent = "Sign In";
                    if(loginBtn.querySelector(".spinner")) loginBtn.querySelector(".spinner").remove();
                });
        });

        // Logout
        if(logoutBtn) {
            logoutBtn.addEventListener("click", (e) => {
                e.preventDefault();
                signOut(auth).then(() => {
                    window.location.reload();
                }).catch((err) => console.error("Logout error", err));
            });
        }

        // Forgot Password (Login Screen)
        if(forgotPwBtn) {
            forgotPwBtn.addEventListener("click", (e) => {
                e.preventDefault();
                const email = document.getElementById("email").value;
                if(!email) {
                    errorMsg.classList.remove('hidden');
                    errorMsg.textContent = "Please enter your email above and click 'Forgot Password?' again.";
                    return;
                }
                if(confirm(`Send password reset email to ${email}?`)) {
                    sendPasswordResetEmail(auth, email)
                        .then(() => alert("Password reset email sent!"))
                        .catch(err => {
                            errorMsg.classList.remove('hidden');
                            errorMsg.textContent = err.message;
                        });
                }
            });
        }

        // Change Password (Sidebar)
        if(changePwBtn) {
            changePwBtn.addEventListener("click", (e) => {
                e.preventDefault();
                const user = auth.currentUser;
                if(user && user.email) {
                    if(confirm(`Send reset email to ${user.email}?`)) {
                        sendPasswordResetEmail(auth, user.email)
                            .then(() => alert("Email sent! Check your inbox to change password."))
                            .catch(err => alert(err.message));
                    }
                }
            });
        }
    </script>

    <!-- Main Logic Script -->
    <script>
        // Formatter
        const fmtM = (val) => {
            if (!val) return '0';
            const millions = val / 1000000;
            return '₩ ' + new Intl.NumberFormat('en-US', { maximumFractionDigits: 1 }).format(millions) + ' M';
        };
        
        const fmtW = (val) => {
             if (!val) return '0';
             return '₩ ' + new Intl.NumberFormat('ko-KR').format(val);
        };

        // Korean Number Formatter
        function formatKoreanMoney(amount) {
            if (!amount) return '0원';
            const uk = Math.floor(amount / 100000000);
            const remainder = amount % 100000000;
            const ten_millions = Math.floor(remainder / 10000000);
            const millions = Math.floor((remainder % 10000000) / 1000000);
            
            let str = '';
            if (uk > 0) str += `${uk}억 `;
            if (ten_millions > 0) str += `${ten_millions}천`;
            if (millions > 0) str += `${millions}백`;
            
            if (ten_millions > 0 || millions > 0) str += '만원';
            else if (uk > 0 && remainder === 0) str += '원';
            else if (uk === 0 && (ten_millions > 0 || millions > 0)) str += '만원';
            
            return str.trim() || '0원';
        }

        // Initialize
        function init() {
            lucide.createIcons();
            populateFilters('ALL'); // Default load
            
            // Set Initial Mode to ALL
            switchSalesMode('ALL');

            // Add Event Listeners for Auto-Update
            document.getElementById('filter-customer').addEventListener('change', renderSalesDashboard);
            
            // Listeners for mode switching
            document.getElementById('mode-all').addEventListener('click', () => switchSalesMode('ALL'));
            document.getElementById('mode-sales1').addEventListener('click', () => switchSalesMode('SALES1'));
            document.getElementById('mode-sales2').addEventListener('click', () => switchSalesMode('SALES2'));
            document.getElementById('mode-service').addEventListener('click', () => switchSalesMode('SERVICE'));

            // Core Project Listeners
             document.getElementById('btn-core-active').addEventListener('click', () => setCoreFilter('Active'));
            document.getElementById('btn-core-completed').addEventListener('click', () => setCoreFilter('Completed'));
            document.getElementById('btn-core-all').addEventListener('click', () => setCoreFilter('All'));

            // Project Mgmt Listeners
             document.getElementById('filterDept').addEventListener('change', renderProjectDashboard);
            document.getElementById('filterCategory').addEventListener('change', renderProjectDashboard);
        }

        // Helper: Normalize Customer Name
        function normalizeCustomer(name) {
            return name;
        }

        // --- Populate Filters Based on Mode ---
        function populateFilters(mode = 'ALL') {
            const d2025 = window.salesData2025 || [];
            const d2026 = window.salesData2026 || [];
            
            if (d2025.length === 0 && d2026.length === 0) {
                // console.warn("No sales data found in window object.");
                return;
            }

            const allData = [...d2025, ...d2026];
            const customers = new Set();
            
            allData.forEach(item => {
                if (item.customer) {
                    customers.add(item.customer); 
                }
            });

            // Special handling for Sales 1 (Add ASM Total)
            if (mode === 'SALES1' || mode === 'ALL') {
                 customers.add("ASM (Total)");
            }

            const custSelect = document.getElementById('filter-customer');
            custSelect.innerHTML = '<option value="ALL">All Customers</option>';

            // Filter Customer List based on Mode
            let filteredCustomers = Array.from(customers);

            if (mode === 'SALES1') {
                // ASM Related Only
                filteredCustomers = filteredCustomers.filter(c => 
                    c === 'ASM (Total)' || c === 'ASM_OEM' || c === 'ASM_CM'
                );
            } else if (mode === 'SALES2') {
                // Non-ASM Only
                filteredCustomers = filteredCustomers.filter(c => 
                    c !== 'ASM (Total)' && c !== 'ASM_OEM' && c !== 'ASM_CM'
                );
            } 
            // Service and ALL show all available customers in data

            // Sorting logic
            const sortedCustomers = filteredCustomers.sort((a, b) => {
                if(a === "ASM (Total)") return -1; 
                if(b === "ASM (Total)") return 1;
                const isKoreanA = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(a);
                const isKoreanB = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(b);
                if (isKoreanA && !isKoreanB) return 1;
                if (!isKoreanA && isKoreanB) return -1;
                return a.localeCompare(b);
            });

            sortedCustomers.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.innerText = c;
                custSelect.appendChild(opt);
            });
            
            // Reset selection to ALL when mode changes
            custSelect.value = 'ALL';
        }

        // --- Sales Dashboard Logic ---
        let activeSalesMode = 'ALL'; 
        let currentSalesCatFilter = 'ALL';
        let chartType = 'normal'; 
        let isAutomotiveIncluded = true; 
        let isAsmCmExcluded = true; // For Service Mode - default true
        let chartInstance = null;

        function setSalesCategoryFilter(cat) {
            currentSalesCatFilter = cat;
            renderSalesDashboard();
        }

        function toggleAutomotiveFilter() {
            isAutomotiveIncluded = !isAutomotiveIncluded;
            const btn = document.getElementById('btn-auto-filter');
            const txt = document.getElementById('txt-auto-filter');
            if(isAutomotiveIncluded) {
                btn.className = "px-3 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700 border border-slate-200 transition-all flex items-center gap-2";
                txt.textContent = "전장사업부 포함";
                btn.innerHTML = `<i data-lucide="cpu" class="w-4 h-4"></i><span id="txt-auto-filter">전장사업부 포함</span>`;
            } else {
                btn.className = "px-3 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 border border-transparent transition-all flex items-center gap-2";
                txt.textContent = "전장사업부 제외";
                btn.innerHTML = `<i data-lucide="cpu" class="w-4 h-4 text-slate-400"></i><span id="txt-auto-filter" class="text-slate-400 decoration-slice line-through">전장사업부 제외</span>`;
            }
            lucide.createIcons();
            renderSalesDashboard();
        }

        function toggleAsmCmExclusion() {
            isAsmCmExcluded = !isAsmCmExcluded;
            const btn = document.getElementById('btn-exclude-asmcm');
            
            if(isAsmCmExcluded) {
                // Active State (Excluded) - Highlighting button
                btn.className = "px-3 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700 border border-slate-200 transition-all flex items-center gap-2";
                btn.innerHTML = `<i data-lucide="minus-circle" class="w-4 h-4 text-brand-700"></i>`;
                btn.title = "ASM_CM Excluded";
            } else {
                // Inactive State (Included)
                btn.className = "px-3 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 border border-transparent transition-all flex items-center gap-2";
                btn.innerHTML = `<i data-lucide="minus-circle" class="w-4 h-4 text-slate-400"></i>`;
                btn.title = "Include ASM_CM";
            }
            lucide.createIcons();
            renderSalesDashboard();
        }

        function setChartType(type) {
            chartType = type;
            const btnNormal = document.getElementById('btn-chart-normal');
            const btnCumul = document.getElementById('btn-chart-cumulative');
            const btnYearly = document.getElementById('btn-chart-yearly');

            const activeClass = "px-3 py-1 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700";
            const inactiveClass = "px-3 py-1 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800";

            if (type === 'normal') {
                btnNormal.className = activeClass;
                btnCumul.className = inactiveClass;
                btnYearly.className = inactiveClass;
            } else if (type === 'cumulative') {
                btnNormal.className = inactiveClass;
                btnCumul.className = activeClass;
                btnYearly.className = inactiveClass;
            } else if (type === 'yearly') {
                btnNormal.className = inactiveClass;
                btnCumul.className = inactiveClass;
                btnYearly.className = activeClass;
            }
            renderSalesDashboard();
        }

        function updateCategoryButtons() {
             ['ALL', 'Sales', 'Repair'].forEach(c => {
                 const btnId = c === 'ALL' ? 'btn-cat-all' : `btn-cat-${c.toLowerCase()}`;
                 const btn = document.getElementById(btnId);
                 if(currentSalesCatFilter === c) {
                     btn.className = "px-3 py-1.5 text-xs font-bold rounded-md bg-brand-50 text-brand-700 border border-brand-100 transition-all flex items-center gap-1 shadow-sm"; 
                 } else {
                     btn.className = "px-3 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 hover:bg-slate-50 border border-transparent transition-all flex items-center gap-1"; 
                 }
             });
        }

        function switchSalesMode(mode) {
            activeSalesMode = mode;
            
            const btnMap = {
                'ALL': 'mode-all',
                'SALES1': 'mode-sales1',
                'SALES2': 'mode-sales2',
                'SERVICE': 'mode-service'
            };
            
            // Update Tab Styles
            Object.keys(btnMap).forEach(key => {
                const btn = document.getElementById(btnMap[key]);
                if (btn) {
                    if (key === mode) {
                        btn.className = "px-4 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700 border border-slate-100 transition-all";
                    } else {
                        btn.className = "px-4 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 transition-all";
                    }
                }
            });

            const filterContainer = document.getElementById('sales-filters-container');
            const categoryFilterGroup = document.getElementById('category-filter-group');
            const autoFilterWrapper = document.getElementById('auto-filter-wrapper');
            const excludeAsmCmWrapper = document.getElementById('exclude-asmcm-wrapper');

            filterContainer.classList.remove('hidden'); // Always show filter container
            
            // Reset Category Filter logic per mode
            if (mode === 'SALES1' || mode === 'SALES2') {
                currentSalesCatFilter = 'Sales';
                categoryFilterGroup.classList.add('hidden'); 
                autoFilterWrapper.classList.add('hidden'); // No auto filter for Sales 1/2 as per request
                excludeAsmCmWrapper.classList.add('hidden');
                // Set default auto exclusion for Sales 1/2 (although logic handles it)
                isAutomotiveIncluded = false; 
            } else if (mode === 'SERVICE') {
                currentSalesCatFilter = 'Repair';
                categoryFilterGroup.classList.add('hidden');
                autoFilterWrapper.classList.add('hidden');
                excludeAsmCmWrapper.classList.remove('hidden'); 
                
                // Initialize Service Mode button state
                const btnExclude = document.getElementById('btn-exclude-asmcm');
                if(isAsmCmExcluded) {
                    btnExclude.className = "px-3 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-brand-700 border border-slate-200 transition-all flex items-center gap-2";
                    btnExclude.innerHTML = `<i data-lucide="minus-circle" class="w-4 h-4 text-brand-700"></i>`;
                    btnExclude.title = "ASM_CM Excluded";
                } else {
                    btnExclude.className = "px-3 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 border border-transparent transition-all flex items-center gap-2";
                    btnExclude.innerHTML = `<i data-lucide="minus-circle" class="w-4 h-4 text-slate-400"></i>`;
                    btnExclude.title = "Include ASM_CM";
                }

            } else {
                // ALL Mode
                categoryFilterGroup.classList.remove('hidden');
                autoFilterWrapper.classList.remove('hidden');
                excludeAsmCmWrapper.classList.add('hidden');
                isAutomotiveIncluded = true; // Default include for ALL, user can toggle
            }

            // Update Customer Dropdown Options
            populateFilters(mode);

            renderSalesDashboard();
            lucide.createIcons();
        }

        function renderSalesDashboard() {
            // Force category filter based on mode if needed
            if (activeSalesMode === 'SALES1' || activeSalesMode === 'SALES2') {
                currentSalesCatFilter = 'Sales';
            } else if (activeSalesMode === 'SERVICE') {
                currentSalesCatFilter = 'Repair';
            }
            
            // Update UI for buttons
            updateCategoryButtons();
            
            // Re-render UI
            renderSalesData();
            lucide.createIcons();
        }

        // Main Rendering Logic
        function renderSalesData() {
            const filterCust = document.getElementById('filter-customer').value;
            const filterCat = currentSalesCatFilter;
            
            const raw2023 = window.salesData2023 || [];
            const raw2024 = window.salesData2024 || [];
            const raw2025 = window.salesData2025 || [];
            const raw2026 = window.salesData2026 || [];

            // Calculate Global Total (for share %)
            const globalTotal2025 = raw2025.reduce((sum, d) => sum + (d.amount || 0), 0);

            // Filter Data Logic
            const filterFn = (d) => {
                // 1. Base Filter (Automotive)
                if (!isAutomotiveIncluded) {
                    if (d.customer && (d.customer.includes('Automotive') || d.customer.includes('전장'))) return false;
                }

                // 2. Service Mode Specific Filter
                if (activeSalesMode === 'SERVICE' && isAsmCmExcluded) {
                    if (d.customer === 'ASM_CM') return false;
                }

                // 3. Customer Dropdown Filter (Manual Selection)
                // If specific customer selected, strictly match
                if (filterCust !== 'ALL') {
                     if (filterCust === "ASM (Total)") {
                        if (!(d.customer === "ASM_OEM" || d.customer === "ASM_CM")) return false;
                    } else if (d.customer !== filterCust) {
                        return false;
                    }
                }

                // 4. Mode Constraints (Implicit Filters)
                if (activeSalesMode === 'SALES1') {
                    // Enforce ASM Only & Sales Category
                    const isAsm = (d.customer === "ASM_OEM" || d.customer === "ASM_CM" || d.customer === "ASM");
                    const isSales = (d.category === 'Sales');
                    return isAsm && isSales;
                } 
                else if (activeSalesMode === 'SALES2') {
                    // Enforce Non-ASM & Sales Category
                    const isAsm = (d.customer === "ASM_OEM" || d.customer === "ASM_CM" || d.customer === "ASM");
                    const isSales = (d.category === 'Sales');
                    return !isAsm && isSales;
                }
                else if (activeSalesMode === 'SERVICE') {
                    // Enforce Repair Category
                    const isRepair = (d.category === 'Repair');
                    return isRepair;
                }
                else {
                    // ALL Mode: Use Category Toggle
                    if (filterCat !== 'ALL' && d.category !== filterCat) return false;
                    return true;
                }
            };

            const filtered2023 = raw2023.filter(filterFn);
            const filtered2024 = raw2024.filter(filterFn);
            const filtered2025 = raw2025.filter(filterFn);
            const filtered2026 = raw2026.filter(filterFn);

            const total2023 = filtered2023.reduce((sum, d) => sum + (d.amount || 0), 0);
            const total2024 = filtered2024.reduce((sum, d) => sum + (d.amount || 0), 0);
            const total2025 = filtered2025.reduce((sum, d) => sum + (d.amount || 0), 0);
            const total2026 = filtered2026.reduce((sum, d) => sum + (d.amount || 0), 0);

            // Calculations for display
            const share2025 = globalTotal2025 ? ((total2025 / globalTotal2025) * 100).toFixed(1) : 0;
            
            // YTD Calculation
            let maxMonth26 = 0;
            filtered2026.forEach(d => { if(d.month > maxMonth26) maxMonth26 = d.month; });
            
            const ytd2025 = filtered2025.reduce((sum, d) => {
                if(d.month <= maxMonth26) return sum + d.amount;
                return sum;
            }, 0);
            
            let yoyPercent = 0;
            if (ytd2025 > 0) {
                yoyPercent = ((total2026 - ytd2025) / ytd2025) * 100;
            }
            
            const yoyFormatted = yoyPercent.toFixed(1);
            const yoyColor = yoyPercent >= 0 ? 'text-emerald-500' : 'text-rose-500';
            const yoySign = yoyPercent >= 0 ? '+' : '';
            const cardAnimationClass = yoyPercent >= 0 ? 'card-pulse-green' : 'card-pulse-orange';

            // Label customization based on mode
            let title2025 = "2025 Total Sales";
            let title2026 = "2026 Actual Sales";
            if (activeSalesMode === 'SALES1') { title2025 = "2025 Sales (ASM)"; title2026 = "2026 Sales (ASM)"; }
            if (activeSalesMode === 'SALES2') { title2025 = "2025 Sales (Others)"; title2026 = "2026 Sales (Others)"; }
            if (activeSalesMode === 'SERVICE') { title2025 = "2025 Service (Repair)"; title2026 = "2026 Service (Repair)"; }
            
            // Format Korean money
            const ko2025 = formatKoreanMoney(total2025);
            const ko2026 = formatKoreanMoney(total2026);

            // Update KPI Cards
            const kpiContainer = document.getElementById('sales-kpi-container');
            kpiContainer.className = "grid grid-cols-1 md:grid-cols-2 gap-6";
            kpiContainer.innerHTML = `
                <div class="white-card p-6 rounded-2xl flex justify-between items-start">
                    <div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">${title2025}</p>
                        <h3 class="text-3xl font-bold text-slate-900 mt-2">${fmtM(total2025)}</h3>
                        <p class="text-[11px] text-slate-400 mt-0.5 font-medium">${ko2025}</p>
                        <p class="text-xs text-slate-400 mt-3"><span class="font-bold text-slate-600">${share2025}%</span> of Total 2025 Revenue</p>
                    </div>
                    <div class="p-3 bg-slate-100 rounded-xl text-slate-400"><i data-lucide="calendar" class="w-6 h-6"></i></div>
                </div>
                <div class="white-card p-6 rounded-2xl flex justify-between items-start ${cardAnimationClass}">
                    <div>
                        <p class="text-xs font-bold text-blue-600 uppercase tracking-widest">${title2026}</p>
                        <h3 class="text-3xl font-bold text-slate-900 mt-2">${fmtM(total2026)}</h3>
                        <p class="text-[11px] text-slate-400 mt-0.5 font-medium">${ko2026}</p>
                        <p class="text-xs text-slate-400 mt-3">YoY (YTD): <span class="font-bold ${yoyColor}">${yoySign}${yoyFormatted}%</span></p>
                    </div>
                    <div class="p-3 bg-blue-50 rounded-xl text-blue-500"><i data-lucide="trending-up" class="w-6 h-6"></i></div>
                </div>
            `;

            // Chart & Table
            renderTrendChart(filtered2023, filtered2024, filtered2025, filtered2026);
            renderShareTable(filtered2026, total2026, filtered2025, total2025); 
        }

        // --- Chart & Table Helpers ---
        function aggregateByMonth(data) {
            const arr = Array(12).fill(0);
            data.forEach(d => {
                if (d.month >= 1 && d.month <= 12) arr[d.month - 1] += (d.amount || 0);
            });
            return arr;
        }

        function calculateCumulative(monthlyData) {
            const cumul = [];
            let sum = 0;
            monthlyData.forEach(val => {
                sum += val;
                cumul.push(sum);
            });
            return cumul;
        }

        function renderTrendChart(data2023, data2024, data2025, data2026) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();

            // Aggregation
            const d23 = aggregateByMonth(data2023);
            const d24 = aggregateByMonth(data2024);
            const d25 = aggregateByMonth(data2025);
            const d26 = aggregateByMonth(data2026);

            // Chart Config Vars
            let chartLabels, chartDatasets;

            if (chartType === 'yearly') {
                // Yearly Chart Logic
                const total23 = d23.reduce((a, b) => a + b, 0);
                const total24 = d24.reduce((a, b) => a + b, 0);
                const total25 = d25.reduce((a, b) => a + b, 0);
                const total26 = d26.reduce((a, b) => a + b, 0);

                const yearlyTotals = [total23, total24, total25, total26];

                chartLabels = ['2023', '2024', '2025', '2026'];
                chartDatasets = [{
                    label: 'Annual Revenue',
                    data: yearlyTotals.map(v => v/1000000), // Convert to Millions for bar height
                    backgroundColor: ['#e2e8f0', '#cbd5e1', '#94a3b8', '#7c3aed'],
                    borderColor: ['#cbd5e1', '#94a3b8', '#64748b', '#7c3aed'],
                    borderWidth: 1,
                    borderRadius: 6,
                    barThickness: 50,
                    datalabels: { 
                        anchor: 'end',
                        align: 'top',
                        formatter: function(value, context) {
                            // value is in Millions
                            const revenueStr = '₩ ' + Math.round(value).toLocaleString() + ' M';
                            
                            if (context.dataIndex === 0) return revenueStr;

                            // Calculate YoY using raw totals to be precise
                            // context.dataIndex corresponds to chartLabels index (0..3)
                            // totals array has raw values at same index
                            const currentRaw = yearlyTotals[context.dataIndex];
                            const prevRaw = yearlyTotals[context.dataIndex - 1];

                            let yoyStr = '';
                            if (prevRaw && prevRaw > 0) {
                                const yoy = ((currentRaw - prevRaw) / prevRaw) * 100;
                                const sign = yoy >= 0 ? '+' : '';
                                yoyStr = `\n(${sign}${yoy.toFixed(1)}%)`;
                            }
                            return revenueStr + yoyStr;
                        },
                        font: { weight: 'bold', size: 11 },
                        color: '#64748b',
                        textAlign: 'center'
                    }
                }];
                // Chart Type override to Bar for Yearly
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: { labels: chartLabels, datasets: chartDatasets },
                    plugins: [ChartDataLabels], // Enable plugin
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        scales: { y: { beginAtZero: true } },
                        plugins: { 
                            tooltip: { callbacks: { label: (ctx) => ctx.dataset.label + ': ' + fmtM(ctx.raw * 1000000) } },
                            datalabels: { display: true } // Ensure display
                        }
                    }
                });

            } else {
                // Normal or Cumulative
                let plot25 = d25;
                let plot26 = d26;

                if (chartType === 'cumulative') {
                    plot25 = calculateCumulative(d25);
                    plot26 = calculateCumulative(d26);
                }

                const chartType2026 = chartType === 'cumulative' ? 'line' : 'bar';

                chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: { 
                        labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'], 
                        datasets: [
                            { 
                                label: chartType === 'cumulative' ? '2025 Cumulative' : '2025 Records', 
                                data: plot25.map(v => v/1000000), 
                                borderColor: '#cbd5e1', 
                                borderWidth: 1,      
                                borderDash: chartType === 'cumulative' ? [] : [5,5], 
                                pointRadius: 4,      
                                pointBackgroundColor: '#cbd5e1',
                                tension: 0.3, 
                                fill: false,
                                datalabels: { display: false }
                            },
                            { 
                                label: chartType === 'cumulative' ? '2026 Cumulative' : '2026 Actual', 
                                data: plot26.map(v => v/1000000), 
                                borderColor: '#0ea5e9', 
                                backgroundColor: '#0ea5e9', 
                                type: chartType2026, 
                                borderRadius: 4,
                                borderWidth: chartType === 'cumulative' ? 3 : 0, 
                                pointRadius: chartType === 'cumulative' ? 4 : 0,
                                tension: 0.3,
                                fill: false,
                                datalabels: { display: false }
                            }
                        ]
                    },
                    plugins: [ChartDataLabels],
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        scales: { y: { beginAtZero: true } },
                        plugins: { tooltip: { callbacks: { label: (ctx) => ctx.dataset.label + ': ' + fmtM(ctx.raw * 1000000) } } }
                    }
                });
            }
        }

        function renderShareTable(data2026, total2026, data2025, total2025) {
            const container = document.getElementById('sales-secondary-container');
            
            const aggregate = (data) => {
                const groups = {};
                data.forEach(d => {
                    const key = `${d.customer} - ${d.category}`;
                    groups[key] = (groups[key] || 0) + (d.amount || 0);
                });
                return groups;
            }

            const groups2026 = aggregate(data2026);
            const groups2025 = aggregate(data2025);
            
            // Collect all unique keys
            const allKeys = new Set([...Object.keys(groups2026), ...Object.keys(groups2025)]);

            const tableRows = Array.from(allKeys).map(key => {
                const [cust, cat] = key.split(' - ');
                const amount26 = groups2026[key] || 0;
                const amount25 = groups2025[key] || 0;

                const share2026 = total2026 ? ((amount26 / total2026) * 100).toFixed(1) : '0.0';
                const share2025 = total2025 ? ((amount25 / total2025) * 100).toFixed(1) : '0.0';

                return { customer: cust, category: cat, amt2025: amount25, share2025, amt2026: amount26, share2026 };
            }).sort((a, b) => b.amt2026 - a.amt2026); // Sort by 2026 Amount Desc

            // Insert ASM Total Row if relevant
            const asmRows = tableRows.filter(r => r.customer === 'ASM_OEM' || r.customer === 'ASM_CM');
            if (asmRows.length > 0 && activeSalesMode !== 'SALES2') {
                const asmTotal2025 = asmRows.reduce((s, r) => s + r.amt2025, 0);
                const asmTotal2026 = asmRows.reduce((s, r) => s + r.amt2026, 0);
                
                const asmShare2025 = total2025 ? ((asmTotal2025 / total2025) * 100).toFixed(1) : '0.0';
                const asmShare2026 = total2026 ? ((asmTotal2026 / total2026) * 100).toFixed(1) : '0.0';
                
                // Prepend ASM Total
                tableRows.unshift({ 
                    customer: 'ASM (Total)', 
                    category: 'Combined', 
                    amt2025: asmTotal2025, 
                    share2025: asmShare2025, 
                    amt2026: asmTotal2026, 
                    share2026: asmShare2026,
                    isSummary: true
                });
            }

            const rows = tableRows.map(row => {
                const bgClass = row.isSummary ? 'bg-blue-50 font-bold' : 'hover:bg-slate-50';
                return `
                    <tr class="${bgClass} border-b border-slate-50 last:border-0">
                        <td class="px-4 py-3 font-medium text-slate-700 text-sm font-sans">${row.customer}</td>
                        <td class="px-4 py-3 text-slate-500 text-sm font-sans">${row.category}</td>
                        <td class="px-4 py-3 text-right font-medium text-slate-400 font-sans text-xs">${fmtW(row.amt2025)}</td>
                        <td class="px-4 py-3 text-right text-slate-400 font-bold text-xs font-sans">${row.share2025}%</td>
                        <td class="px-4 py-3 text-right font-medium text-slate-900 font-sans text-sm">${fmtW(row.amt2026)}</td>
                        <td class="px-4 py-3 text-right text-blue-600 font-bold text-sm font-sans">${row.share2026}%</td>
                    </tr>
                `;
            }).join('');

            container.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-800">Market Share Analysis (2025 vs 2026)</h3>
                    <button onclick="downloadMarketShareCSV()" class="p-2 hover:bg-slate-100 rounded-lg text-slate-500 transition-colors" title="Download CSV">
                        <i data-lucide="download" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="overflow-x-auto flex-1 h-[300px] custom-scrollbar">
                    <table class="w-full text-left" id="share-table">
                        <thead class="bg-slate-50 text-slate-500 font-bold border-b border-slate-200 sticky top-0">
                            <tr>
                                <th class="px-4 py-3 text-xs uppercase tracking-wider font-sans">Customer</th>
                                <th class="px-4 py-3 text-xs uppercase tracking-wider font-sans">Category</th>
                                <th class="px-4 py-3 text-right text-xs uppercase tracking-wider font-sans text-slate-400">2025 Amt</th>
                                <th class="px-4 py-3 text-right text-xs uppercase tracking-wider font-sans text-slate-400">2025 %</th>
                                <th class="px-4 py-3 text-right text-xs uppercase tracking-wider font-sans">2026 Amt</th>
                                <th class="px-4 py-3 text-right text-xs uppercase tracking-wider font-sans">2026 %</th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-600">${rows || '<tr><td colspan="6" class="p-4 text-center">No Data</td></tr>'}</tbody>
                    </table>
                </div>
            `;
            lucide.createIcons();
        }

        window.downloadMarketShareCSV = function() {
             const table = document.getElementById("share-table");
             if(!table) return;
             
             let csv = [];
             const rows = table.querySelectorAll("tr");
             
             for (let i = 0; i < rows.length; i++) {
                const row = [], cols = rows[i].querySelectorAll("td, th");
                for (let j = 0; j < cols.length; j++) 
                    row.push('"' + cols[j].innerText.replace(/,/g, "") + '"'); // Remove commas for CSV number format
                csv.push(row.join(","));
             }

             const csvFile = new Blob([csv.join("\n")], {type: "text/csv"});
             const downloadLink = document.createElement("a");
             downloadLink.download = "market_share_analysis.csv";
             downloadLink.href = window.URL.createObjectURL(csvFile);
             downloadLink.style.display = "none";
             document.body.appendChild(downloadLink);
             downloadLink.click();
             document.body.removeChild(downloadLink);
        };

        // --- Module Switching ---
        function switchModule(module) {
            document.getElementById('module-sales').classList.add('hidden');
            document.getElementById('module-project').classList.add('hidden');
            document.getElementById('module-core').classList.add('hidden');
            
            document.getElementById('nav-sales').classList.remove('active');
            document.getElementById('nav-project').classList.remove('active');
            document.getElementById('nav-core').classList.remove('active');
            
            document.getElementById('header-actions').classList.add('hidden');

            const headerTitle = document.getElementById('header-title');

            if (module === 'sales') {
                document.getElementById('module-sales').classList.remove('hidden');
                document.getElementById('nav-sales').classList.add('active');
                headerTitle.innerHTML = '<i data-lucide="pie-chart" class="w-5 h-5 text-brand-600"></i> Integrated Sales Dashboard';
                document.getElementById('header-actions').classList.remove('hidden');
                renderSalesDashboard();
            } else if (module === 'project') {
                document.getElementById('module-project').classList.remove('hidden');
                document.getElementById('nav-project').classList.add('active');
                headerTitle.innerHTML = '<i data-lucide="box" class="w-5 h-5 text-brand-600"></i> ASM Project Management';
                renderProjectDashboard(); // Re-trigger to update stats
            } else if (module === 'core') {
                document.getElementById('module-core').classList.remove('hidden');
                document.getElementById('nav-core').classList.add('active');
                headerTitle.innerHTML = '<i data-lucide="star" class="w-5 h-5 text-brand-600"></i> ASM Core Project';
                renderCoreProjects();
            }
            lucide.createIcons();
        }

        // --- Core Project Logic ---
        let currentStatusFilter = 'ALL'; 
        let coreProjectFilter = 'Active'; 
        
        function setStatusFilter(status) {
            if (currentStatusFilter === status) currentStatusFilter = 'ALL';
            else currentStatusFilter = status;
            renderProjectDashboard();
        }
        function updateStatusButtons() {
            ['OPEN', 'FINISHED', 'CLOSE'].forEach(s => {
                const btn = document.getElementById(`btn-status-${s}`);
                if (currentStatusFilter === s) btn.className = "flex-1 rounded-lg text-xs font-bold transition-all bg-brand-600 shadow-md text-white border border-brand-500";
                else btn.className = "flex-1 rounded-lg text-xs font-bold transition-all text-slate-500 hover:text-slate-800 hover:bg-white";
            });
        }
        function renderProjectDashboard() {
            const deptFilter = document.getElementById('filterDept').value;
            const catFilter = document.getElementById('filterCategory').value;
            updateStatusButtons();
            const tbody = document.getElementById('project-table-body');
            tbody.innerHTML = '';
            
            // Get Project Data (from window)
            const pData = window.projectAsmData || [];
            
            let filtered = pData.filter(p => {
                const pCustomer = (p.customer || '').toString().trim();
                const pDept = (p.dept || '').toString().trim();
                const pCat = (p.category || '').toString().trim();
                const pStatus = (p.progress || '').toString().trim();
                if (!pCustomer) return false;
                const matchesDept = deptFilter === 'ALL' || pDept === deptFilter;
                const matchesCat = catFilter === 'ALL' || pCat === catFilter;
                const matchesStatus = currentStatusFilter === 'ALL' || pStatus === currentStatusFilter;
                return matchesDept && matchesCat && matchesStatus;
            });
            filtered.sort((a, b) => (Number(a.priority)||999) - (Number(b.priority)||999));
            
            // Re-calc Stats based on FULL data (or filtered? usually full context is better for top cards)
            // But let's use the full valid data for the global stats card as requested previously
            const validData = pData.filter(p => (p.customer || '').toString().trim() !== '');
            const totalCount = validData.length;
            const openCount = validData.filter(p => (p.progress||'').trim() === 'OPEN').length;
            const doneCount = validData.filter(p => (p.progress||'').trim() === 'FINISHED' || (p.progress||'').trim() === 'CLOSE').length;

            document.getElementById('pstat-total').textContent = totalCount;
            document.getElementById('pstat-open').textContent = openCount;
            document.getElementById('pstat-done').textContent = doneCount;
            
            filtered.forEach(p => {
                const prog = (p.progress || '').trim();
                const statusClass = prog === 'OPEN' ? 'status-open' : (prog === 'FINISHED' ? 'status-finished' : 'status-close');
                const row = document.createElement('tr');
                row.className = "hover:bg-slate-50 transition-all border-b border-slate-100 last:border-0";
                row.innerHTML = `<td class="px-6 py-4 font-bold text-slate-500">${p.priority}</td><td class="px-6 py-4"><div class="font-bold text-slate-700">${p.customer}</div><div class="text-slate-500 font-medium text-[10px]">${p.requestor}</div></td><td class="px-6 py-4 font-semibold text-slate-500 text-[11px]">${p.category}</td><td class="px-6 py-4"><div class="font-bold text-brand-600">${p.model}</div><div class="text-[10px] font-mono text-slate-400">${p.pn}</div></td><td class="px-6 py-4 font-bold text-slate-600">${p.demand}</td><td class="px-6 py-4"><div class="text-slate-500 leading-tight text-[11px]">${p.specification}</div><div class="text-[10px] text-slate-400 italic">${p.application}</div></td><td class="px-6 py-4"><div class="font-bold text-slate-600">${p.dept}</div><div class="text-[10px] text-brand-500 font-bold">${p.nbd}</div></td><td class="px-6 py-4"><span class="progress-badge ${statusClass}">${prog}</span></td>`;
                tbody.appendChild(row);
            });
        }

        // --- Core Project Logic ---
        function getTrafficLight(plan, close) {
            if (!plan) return 'light-gray';
            const planDate = new Date(plan);
            const closeDate = close ? new Date(close) : null;
            const today = new Date();
            if (closeDate) return (closeDate <= planDate) ? 'light-green' : 'light-red';
            if (today > planDate) return 'light-red';
            return 'light-gray';
        }
        function getProgressSegmentColor(plan, close) {
            if (!plan) return 'prog-gray';
            const planDate = new Date(plan);
            const closeDate = close ? new Date(close) : null;
            if (closeDate) return (closeDate <= planDate) ? 'prog-green' : 'prog-orange';
            return 'prog-gray';
        }
        function setCoreFilter(filter) {
            coreProjectFilter = filter;
            renderCoreProjects();
        }
        function updateCoreFilterButtons() {
            ['Active', 'Completed', 'All'].forEach(f => {
                const btn = document.getElementById(`btn-core-${f.toLowerCase()}`);
                if (coreProjectFilter === f) btn.className = "px-4 py-2 rounded-lg text-xs font-bold transition-all bg-brand-600 shadow-md text-white border border-brand-500";
                else btn.className = "px-4 py-2 rounded-lg text-xs font-bold transition-all text-slate-500 hover:text-slate-800 hover:bg-white/50";
            });
        }
        function renderCoreProjects() {
            updateCoreFilterButtons();
            const grid = document.getElementById('core-project-grid');
            grid.innerHTML = '';
            
            // Get Core Data (from window)
            const coreData = window.coreProjectData || [];
            
            const filteredCore = coreData.filter(p => {
                if (coreProjectFilter === 'All') return true;
                if (coreProjectFilter === 'Completed') return p.status === 'Completed';
                return p.status !== 'Completed';
            });
            filteredCore.forEach(p => {
                let borderClass = 'border-l-4 border-l-gray-300';
                let statusBg = 'bg-gray-100 text-gray-600';
                if (p.status === 'On Track' || p.status === 'Completed') { borderClass = 'border-fast'; statusBg = 'bg-ontrack'; }
                else if (p.status === 'Delayed' || p.status === 'Critical') { borderClass = 'border-slow'; statusBg = 'bg-delayed'; }
                const tl_p0 = getTrafficLight(p.phase_0_plan, p.phase_0_close);
                const tl_p1 = getTrafficLight(p.phase_1_plan, p.phase_1_close);
                const tl_jdp = getTrafficLight(p.JDP_plan, p.JDP_close);
                const pb_p0 = getProgressSegmentColor(p.phase_0_plan, p.phase_0_close);
                const pb_p1 = getProgressSegmentColor(p.phase_1_plan, p.phase_1_close);
                const pb_jdp = getProgressSegmentColor(p.JDP_plan, p.JDP_close);
                const p0Plan = p.phase_0_plan || '-';
                const p0Close = p.phase_0_close || '-';
                const p1Plan = p.phase_1_plan || '-';
                const p1Close = p.phase_1_close || '-';
                const jdpPlan = p.JDP_plan || '-';
                const jdpClose = p.JDP_close || '-';
                const startDateDisplay = p0Plan !== '-' ? p0Plan : 'TBD';
                
                const card = document.createElement('div');
                if (p.tasks && p.tasks.includes('LDMOS')) {
                    card.className = `white-card p-0 rounded-2xl shadow-sm hover:shadow-md transition-all flex flex-col overflow-hidden ${borderClass} cursor-pointer hover:ring-2 hover:ring-brand-500`;
                    card.onclick = function() { window.open('LDMOS_details.html', '_blank'); };
                } else {
                    card.className = `white-card p-0 rounded-2xl shadow-sm hover:shadow-md transition-all flex flex-col overflow-hidden ${borderClass}`;
                }
                card.innerHTML = `
                    <div class="p-5 border-b border-slate-100">
                        <div class="flex justify-between items-start mb-2"><span class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider ${statusBg}">${p.status}</span><div class="flex gap-1"><span class="px-2 py-1 rounded bg-slate-100 text-slate-500 text-[10px] font-bold">${p.dept}</span><span class="px-2 py-1 rounded bg-slate-100 text-slate-500 text-[10px] font-bold">${p.category}</span></div></div>
                        <h3 class="text-lg font-bold text-slate-800 leading-tight mb-1">${p.tasks}</h3><p class="text-sm font-semibold text-brand-600">${p.model}</p>
                    </div>
                    <div class="p-5 space-y-4 flex-1">
                        <div class="space-y-3">
                            <div class="flex items-center text-xs"><div class="w-20 font-bold text-slate-500 flex items-center gap-2"><span class="w-2.5 h-2.5 rounded-full ${tl_p0} inline-block"></span>Phase 0</div><div class="flex-1 grid grid-cols-2 gap-2"><div class="bg-slate-50 px-2 py-1 rounded text-slate-500 border border-slate-100"><span class="text-[9px] text-slate-400 block">Plan</span>${p0Plan}</div><div class="bg-white px-2 py-1 rounded text-slate-700 border border-slate-200 ${p.phase_0_close ? 'font-bold' : 'text-slate-300'}"><span class="text-[9px] text-slate-400 block">Close</span>${p0Close}</div></div></div>
                            <div class="flex items-center text-xs"><div class="w-20 font-bold text-slate-500 flex items-center gap-2"><span class="w-2.5 h-2.5 rounded-full ${tl_p1} inline-block"></span>Phase 1</div><div class="flex-1 grid grid-cols-2 gap-2"><div class="bg-slate-50 px-2 py-1 rounded text-slate-500 border border-slate-100"><span class="text-[9px] text-slate-400 block">Plan</span>${p1Plan}</div><div class="bg-white px-2 py-1 rounded text-slate-700 border border-slate-200 ${p.phase_1_close ? 'font-bold' : 'text-slate-300'}"><span class="text-[9px] text-slate-400 block">Close</span>${p1Close}</div></div></div>
                            <div class="flex items-center text-xs"><div class="w-20 font-bold text-slate-500 flex items-center gap-2"><span class="w-2.5 h-2.5 rounded-full ${tl_jdp} inline-block"></span>JDP</div><div class="flex-1 grid grid-cols-2 gap-2"><div class="bg-slate-50 px-2 py-1 rounded text-slate-500 border border-slate-100"><span class="text-[9px] text-slate-400 block">Plan</span>${jdpPlan}</div><div class="bg-white px-2 py-1 rounded text-slate-700 border border-slate-200 ${p.JDP_close ? 'font-bold' : 'text-slate-300'}"><span class="text-[9px] text-slate-400 block">Close</span>${jdpClose}</div></div></div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-slate-50"><div class="flex h-2 w-full rounded-full overflow-hidden bg-slate-100"><div class="flex-1 ${pb_p0} border-r border-white"></div><div class="flex-1 ${pb_p1} border-r border-white"></div><div class="flex-1 ${pb_jdp}"></div></div><div class="flex justify-between mt-1 text-[10px] text-slate-400 font-medium"><span>Start: ${startDateDisplay}</span><span>Target: ${p.target}</span></div></div>
                    </div>
                    <div class="bg-slate-50 p-4 border-t border-slate-100 text-xs">${p.note ? `<div class="text-slate-500 font-bold bg-white p-2 rounded border border-slate-200 text-[12px]"><span class="font-bold text-amber-500 not-italic mr-1">Note:</span>${p.note}</div>` : '<div class="text-slate-300 italic text-[11px] text-center">No additional notes</div>'}</div>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
